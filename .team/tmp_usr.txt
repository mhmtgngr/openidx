REQUIREMENTS (enriched with market research):
{
 "project_name": "WebAuthn Security Hardening",
 "summary": "Implement proper JWT-based authentication middleware and CSRF protection for WebAuthn credential management endpoints in internal/mfa/webauthn_handler.go to address critical security vulnerabilities at lines 515 and 525.",
 "functional_requirements": [
  {
   "id": "FR-001",
   "title": "JWT Authentication Middleware Integration"
  },
  {
   "id": "FR-002",
   "title": "CSRF Protection Implementation"
  },
  {
   "id": "FR-003",
   "title": "User Ownership Verification"
  },
  {
   "id": "FR-004",
   "title": "WebAuthn Endpoint Protection Configuration"
  }
 ],
 "affected_services": [
  "identity-service",
  "mfa-service"
 ],
 "implementation_phases": [
  {
   "phase": 1,
   "name": "Authentication Middleware Integration",
   "tasks": [
    "Add internal/auth/middleware dependency to mfa package",
    "Create constructor accepting RBACMiddleware and TokenService",
    "Replace AuthMiddleware() with proper JWT validation",
    "Add unit tests for authentication scenarios"
   ]
  },
  {
   "phase": 2,
   "name": "CSRF Protection Implementation",
   "tasks": [
    "Integrate internal/common/middleware/csrf.go CSRFProtection",
    "Add CSRF token generation endpoint",
    "Implement double-submit cookie validation",
    "Add SameSite cookie configuration",
    "Add CSRF bypass for authenticated API clients (Bearer-only)"
   ]
  },
  {
   "phase": 3,
   "name": "User Ownership Verification",
   "tasks": [
    "Update HandleListCredentials to validate JWT subject",
    "Update HandleDeleteCredential with ownership checks",
    "Update HandleRenameCredential with ownership checks",
    "Remove user_id query parameter reliance (use from JWT)"
   ]
  },
  {
   "phase": 4,
   "name": "Testing and Documentation",
   "tasks": [
    "Add integration tests for protected endpoints",
    "Add security tests for CSRF bypass attempts",
    "Document API authentication requirements",
    "Update OpenAPI specification with security schemas"
   ]
  }
 ]
}

MARKET ANALYSIS:
Now I have gathered comprehensive information about the OpenIDX project and its competitors. Let me compile the market analysis into the requested JSON format.

{
  "competitor_summary": [
    {
      "name": "Microsoft Entra ID",
      "strengths": ["Deep Microsoft 365 ecosystem integration", "AI-driven threat detection with Identity Protection", "Risk-based conditional access policies", "Enterprise SSO with 500+ app connectors", "Entra Connect for AD/LDAP synchronization", "PIM for privileged access management", " bundled pricing with M365 licenses"],
      "weaknesses": ["Vendor lock-in to Microsoft ecosystem", "Complex pricing tiers", "Less flexible in non-Microsoft environments", "Higher TCO for organizations without M365"],
      "pricing_model": "Bundled with Microsoft 365 (P2: $12/user/month) or standalone pricing"
    },
    {
      "name": "Okta",
      "strengths": ["7000+ pre-built application integrations", "Best-in-class SSO capabilities", "Advanced Adaptive MFA with ThreatInsight", "Identity Fabric for complex ecosystems", "Strong support for hybrid environments", "Okta Verify for push-based MFA", "Lifecycle Workflows automation"],
      "weaknesses": ["Per-feature pricing can become expensive", "Complex setup for advanced features", "Premium support costs extra"],
      "pricing_model": "Per-feature/per-user pricing ($2-$15+ per user/month depending on features)"
    },
    {
      "name": "Duo Security",
      "strengths": ["Specialized in MFA with Duo Push", "Device health checking and posture assessment", "Trusted Access with risk-based authentication", "Simple deployment model", "Strong mobile device management"],
      "weaknesses": ["Limited full IAM suite compared to Entra/Okta", "Focused primarily on authentication not full IGA", "Fewer enterprise governance features"],
      "pricing_model": "$3-$9 per user/month for MFA, additional for PAM features"
    },
    {
      "name": "SailPoint",
      "strengths": ["Best-in-class Identity Governan

PROJECT CONTEXT (from CLAUDE.md):
# CLAUDE.md - OpenIDX Development Guide

## Project Overview

OpenIDX is an open-source Zero Trust Access Platform (ZTAP) that provides enterprise-grade Identity and Access Management. It competes with commercial solutions like Microsoft Entra ID, Okta, and Duo while offering 70-80% cost savings.

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                     API Gateway (APISIX)                        │
└─────────────────────────────────────────────────────────────────┘
                                │
    ┌───────────────────────────┼───────────────────────┐
    │                           │                       │
┌───▼───┐  ┌───────▼───────┐  ┌───▼───┐  ┌───────▼─────┐
│Identity│  │  Governance  │  │Provis-│  │    Audit   │
│Service │  │   Service    │  │ioning │  │   Service  │
└────────┘  └──────────────┘  └───────┘  └────────────┘
    │               │              │             │
    └───────────────┼──────────────┴─────────────┘
                    │
         ┌──────────▼──────────┐
         │  Policy Engine (OPA)│
         └─────────────────────┘
                    │
    ┌───────────────┼───────────────┐
    │               │               │
┌───▼───┐     ┌─────▼─────┐   ┌─────▼─────┐
│Postgres│    │   Redis   │   │Elasticsearch│
└────────┘    └───────────┘   └────────────┘
```

## Tech Stack

### Backend (Go 1.22+)
- **Framework**: Gin (HTTP router)
- **Database**: PostgreSQL with pgx driver
- **Cache**: Redis with go-redis
- **Logging**: Zap
- **Config**: Viper
- **JWT**: golang-jwt/v5

### Frontend (React 18+)
- **Framework**: React with TypeScript
- **Build**: Vite
- **Styling**: Tailwind CSS
- **State**: Zustand + React Query
- **UI**: Radix UI primitives
- **Auth**: OpenIDX OAuth (PKCE)

### Infrastructure
- **OAuth/OIDC**: Native OpenIDX OAuth Service
- **API Gateway**: Apache APISIX
- **Policy Engine**: Open Policy Agent (OPA)
- **Container**: Docker + Kub

EXISTING FILES:
internal/access/app_publish.go
internal/access/browzer_config.go
internal/access/browzer_targets.go
internal/access/context_evaluator.go
internal/access/continuous_verify.go
internal/access/device_health.go
internal/access/feature_handlers.go
internal/access/feature_manager.go
internal/access/guacamole.go
internal/access/health_handlers.go
internal/access/multi_idp.go
internal/access/platform_certs.go
internal/access/policy_dsl.go
internal/access/posture.go
internal/access/service.go
internal/access/temp_access.go
internal/access/unified_audit.go
internal/access/ziti_auth_handlers.go
internal/access/ziti_browzer.go
internal/access/ziti_browzer_handlers.go
internal/access/ziti_config_handlers.go
internal/access/ziti_discovery.go
internal/access/ziti_fabric.go
internal/access/ziti_fabric_handlers.go
internal/access/ziti.go
internal/access/ziti_handlers.go
internal/access/ziti_hardening.go
internal/access/ziti_session_handlers.go
internal/access/ziti_sync_handlers.go
internal/access/ziti_terminator_handlers.go
internal/access/ziti_user_sync.go
internal/admin/admin_audit.go
internal/admin/ai_agents.go
internal/admin/ai_recommendations.go
internal/admin/analytics_enhanced.go
internal/admin/attestation.go
internal/admin/audit_archival.go
internal/admin/auth_handler.go
internal/admin/bulk_import_export.go
internal/admin/bulk_operations.go
internal/admin/config.go
internal/admin/dashboard_enhanced.go
internal/admin/dashboard.go
internal/admin/deprovisioning.go
internal/admin/developer.go
internal/admin/email_templates.go
internal/admin/error_catalog.go
internal/admin/errors_helper.go
internal/admin/federation.go
internal/admin/handler.go

Design the complete solution. Include market-driven features where priority is critical/high. Be specific about file paths, function names, schemas, implementation order.

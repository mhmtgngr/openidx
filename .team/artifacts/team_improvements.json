{
  "steps": [
    {
      "order": 1,
      "name": "Fix phase_deploy unsafe pipes",
      "category": "safety",
      "priority": "critical",
      "target_function": "phase_deploy (lines 985-1270)",
      "description": "Add '|| true' to 13 unsafe pipes in phase_deploy. The grep/sed/awk pipes that check logs and extract errors will kill the script on no-match. Find all bare pipes (without || true) in this function and add safety, especially around: grep -i error, grep FAILED, jq -r exits. Example: 'docker logs $name 2>&1 | grep -i error || true' instead of 'docker logs $name 2>&1 | grep -i error'",
      "verification": "bash -n team.sh && grep -c '|| true' team.sh | grep -E '^[6-9][0-9]$'",
      "risk": "low"
    },
    {
      "order": 2,
      "name": "Add health check timeout guards",
      "category": "crash_fix",
      "priority": "critical",
      "target_function": "detect_service_ports (line 628), phase_deploy (line 1128)",
      "description": "The hardcoded curl health checks at lines 628 and 1128 can hang indefinitely. Wrap both in timeout subshells: '(timeout 5 curl -sf --max-time 5 \"http://localhost:${port}/health\" >/dev/null 2>&1 && h=$((h+1)) && log \"  \u2713 :$port\") || warn \"  \u2717 :$port (timeout/refused)\"'. Same for line 1128 in smoke test.",
      "verification": "grep -n 'timeout.*curl.*health' team.sh | wc -l | grep 2",
      "risk": "low"
    },
    {
      "order": 3,
      "name": "Add claude_do timeout wrapper",
      "category": "crash_fix",
      "priority": "high",
      "target_function": "claude_do (lines 725-760)",
      "description": "claude_do has no timeout protection. AI calls can hang. Add timeout wrapper: 'gtimeout 300 claude_opus \"$prompt\" 2>&1 || { warn \"claude_do timeout/failure: $?\"; return 1; }'. Detect if gtimeout exists, else use timeout. Use variable CLAUDE_TIMEOUT=300 default.",
      "verification": "grep -n 'timeout.*claude' team.sh | grep -v '#'",
      "risk": "low"
    }
  ],
  "process_health": {
    "score": 45,
    "biggest_risk": "phase_deploy has 13 unsafe pipes - grep/sed/awk that return non-zero on no-match terminate the entire script due to 'set -euo pipefail'",
    "biggest_win": "Fixing unsafe pipes in phase_deploy eliminates the single largest crash source (285 lines, 13 unsafe pipes)"
  }
}
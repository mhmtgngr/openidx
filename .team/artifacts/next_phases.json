{
  "phases": [
    {
      "order": 1,
      "name": "Fix SessionService.DeleteByUser Test",
      "priority": "critical",
      "category": "test",
      "description": "The TestSessionService_DeleteByUser test at internal/auth/session_test.go:374 is failing. The test expects an error containing 'session not found' when deleting sessions for a non-existent user, but the method returns nil instead. Review the DeleteByUser method implementation and ensure it properly handles the case where a user has no sessions or doesn't exist. The method should return a domain error rather than nil when no sessions are found for deletion.",
      "success_criteria": [
        "TestSessionService_DeleteByUser passes",
        "go test ./internal/auth/... passes all tests",
        "DeleteByUser returns appropriate error for non-existent users"
      ],
      "estimated_minutes": 45
    },
    {
      "order": 2,
      "name": "Fix WebAuthN Middleware TODOs",
      "priority": "high",
      "category": "security",
      "description": "Two critical security TODOs exist in internal/mfa/webauthn_handler.go at lines 515 and 525. Line 515 notes 'Implement proper authentication middleware' and line 525 notes 'Implement proper CSRF protection'. These are security-critical endpoints for WebAuthN credential management. Implement JWT-based authentication middleware using the existing internal/auth/middleware package and add CSRF token validation using double-submit cookie pattern or same-site cookies with strict flags.",
      "success_criteria": [
        "WebAuthN handlers use proper authentication middleware",
        "CSRF protection implemented on state-changing endpoints",
        "TODO comments removed from webauthn_handler.go lines 515 and 525"
      ],
      "estimated_minutes": 90
    },
    {
      "order": 3,
      "name": "Complete SMS Provider Test Coverage",
      "priority": "medium",
      "category": "test",
      "description": "The TODO at internal/oauth/oidc_test.go:312 indicates need for mock Redis setup. The SMS provider code in internal/sms/providers_tr.go has Turkish phone number normalization logic that could benefit from tests. Set up a mock Redis using miniredis or testcontainers for the OIDC tests, and add comprehensive unit tests for the normalizePhoneTR function covering the three normalization paths: 90XXXXXXXXXX format preservation, 0XXXXXXXXXX to 90XXXXXXXXXX conversion, and 5XXXXXXXXX to 905XXXXXXXXX conversion.",
      "success_criteria": [
        "OIDC tests have working mock Redis setup",
        "TODO comment removed from oidc_test.go:312",
        "Unit tests added for normalizePhoneTR covering all formats",
        "go test ./internal/oauth/... and ./internal/sms/... pass"
      ],
      "estimated_minutes": 75
    }
  ],
  "project_health": {
    "score": 72,
    "critical_issues": [
      "Failing test in session service (TestSessionService_DeleteByUser)",
      "Missing authentication middleware on WebAuthN endpoints",
      "Missing CSRF protection on WebAuthN endpoints",
      "Mock Redis not configured for OIDC tests"
    ],
    "strengths": [
      "Build passes successfully",
      "337 Go files with substantial codebase",
      "97 test files indicating good test coverage intent",
      "Docker support with 12 Dockerfiles",
      "Frontend exists with React 18 + TypeScript",
      "Recent team script improvements for reliability"
    ]
  },
  "rationale": "Phase 1 addresses the failing test as the highest priority - tests must pass before any feature work. Phase 2 tackles the security TODOs in WebAuthN handlers, as missing authentication and CSRF protection are security vulnerabilities that must be addressed before production use. Phase 3 completes the test infrastructure (mock Redis) and adds missing test coverage for SMS phone normalization, ensuring reliability of critical communication features. This ordering follows the rules: compilation is already passing, so fix tests first, then address security issues, then complete test infrastructure."
}
routes:
  # Simple CORS preflight handling
  - uri: /.*
    name: cors-preflight
    methods: ["OPTIONS"]
    plugins:
      cors:
        allow_origins: "http://localhost:3000"
        allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
        allow_headers: "Content-Type,Authorization,X-Requested-With,Accept,Origin"
        max_age: 86400
    upstream:
      type: roundrobin
      nodes:
        "admin-api:8005": 1

  # Identity service
  - uri: /api/v1/identity/*
    name: identity-service
    plugins:
      limit-req:
        rate: 100
        burst: 50
        key: remote_addr
      cors:
        allow_origins: "http://localhost:3000"
        allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
        allow_headers: "Content-Type,Authorization,X-Requested-With"
        max_age: 3600
    upstream:
      type: roundrobin
      nodes:
        "identity-service:8001": 1

  # Governance service
  - uri: /api/v1/governance/*
    name: governance-service
    plugins:
      limit-req:
        rate: 50
        burst: 25
        key: remote_addr
      cors:
        allow_origins: "http://localhost:3000"
        allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
        allow_headers: "Content-Type,Authorization,X-Requested-With"
        max_age: 3600
    upstream:
      type: roundrobin
      nodes:
        "governance-service:8002": 1

  # Provisioning service
  - uri: /api/v1/provisioning/*
    name: provisioning-service
    plugins:
      limit-req:
        rate: 30
        burst: 15
        key: remote_addr
      cors:
        allow_origins: "http://localhost:3000"
        allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
        allow_headers: "Content-Type,Authorization,X-Requested-With"
        max_age: 3600
    upstream:
      type: roundrobin
      nodes:
        "provisioning-service:8003": 1

  # Audit service
  - uri: /api/v1/audit/*
    name: audit-service
    plugins:
      limit-req:
        rate: 200
        burst: 100
        key: remote_addr
      cors:
        allow_origins: "http://localhost:3000"
        allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
        allow_headers: "Content-Type,Authorization,X-Requested-With"
        max_age: 3600
    upstream:
      type: roundrobin
      nodes:
        "audit-service:8004": 1

  # Admin API (no auth for testing)
  - uri: /api/v1/*
    name: admin-api
    plugins:
      limit-req:
        rate: 50
        burst: 25
        key: remote_addr
      cors:
        allow_origins: "http://localhost:3000"
        allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
        allow_headers: "Content-Type,Authorization,X-Requested-With,Accept,Origin"
        max_age: 3600
    upstream:
      type: roundrobin
      nodes:
        "admin-api:8005": 1

global_rules:
  - id: 1
    plugins:
      request-id: {}
#END

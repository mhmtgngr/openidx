# ============================================================================
# OpenIDX Production Environment Configuration
# Domain: openidx.tdv.org
# ============================================================================
# WARNING: This file contains sensitive secrets.
# DO NOT commit this file to version control.
# Ensure proper file permissions: chmod 600 .env.production
# ============================================================================

# ============================================================================
# General Configuration
# ============================================================================

APP_ENV=production
DOMAIN=openidx.tdv.org
LOG_LEVEL=info
TZ=UTC

# ============================================================================
# Database Configuration
# ============================================================================

POSTGRES_PASSWORD=CHANGE_THIS_GENERATE_SECURE_PASSWORD
POSTGRES_BACKUP_PATH=./backups/postgres
POSTGRES_DATA_PATH=./data/postgres

# ============================================================================
# Redis Configuration
# ============================================================================

REDIS_PASSWORD=CHANGE_THIS_GENERATE_SECURE_PASSWORD
REDIS_DATA_PATH=./data/redis

# ============================================================================
# Elasticsearch Configuration
# ============================================================================

ELASTICSEARCH_DATA_PATH=./data/elasticsearch

# ============================================================================
# etcd Configuration
# ============================================================================

ETCD_DATA_PATH=./data/etcd

# ============================================================================
# JWT/OAuth Configuration
# ============================================================================

# Generate with: openssl rand -base64 64
JWT_SECRET=CHANGE_THIS_GENERATE_SECURE_JWT_SECRET_64_BYTES

# OAuth Issuer URL
OAUTH_ISSUER=https://openidx.tdv.org

# JWKS URL (auto-discovery endpoint)
OAUTH_JWKS_URL=https://openidx.tdv.org/.well-known/jwks.json

# ============================================================================
# SMTP Configuration (Email)
# ============================================================================

# Mailgun example (recommended for production)
SMTP_HOST=smtp.mailgun.org
SMTP_PORT=587
SMTP_USER=postmaster@openidx.tdv.org
SMTP_PASSWORD=CHANGE_THIS_SMTP_PASSWORD
SMTP_FROM=noreply@openidx.tdv.org
SMTP_USE_TLS=true

# Alternative: AWS SES
# SMTP_HOST=email-smtp.us-east-1.amazonaws.com
# SMTP_PORT=587
# SMTP_USER=YOUR_SES_SMTP_USERNAME
# SMTP_PASSWORD=YOUR_SES_SMTP_PASSWORD
# SMTP_FROM=noreply@openidx.tdv.org

# Alternative: SendGrid
# SMTP_HOST=smtp.sendgrid.net
# SMTP_PORT=587
# SMTP_USER=apikey
# SMTP_PASSWORD=YOUR_SENDGRID_API_KEY
# SMTP_FROM=noreply@openidx.tdv.org

# ============================================================================
# Access Service Configuration
# ============================================================================

# Generate with: openssl rand -base64 64
ACCESS_SESSION_SECRET=CHANGE_THIS_GENERATE_SECURE_SESSION_SECRET

# ============================================================================
# Ziti Configuration (BrowZer Zero Trust)
# ============================================================================

ZITI_ENABLED=true
ZITI_PWD=CHANGE_THIS_ZITI_ADMIN_PASSWORD
ZITI_ADMIN_USER=admin
ZITI_CTRL_URL=https://ziti-controller.openidx.tdv.org:1280

# ============================================================================
# Guacamole Configuration
# ============================================================================

GUACAMOLE_ADMIN_PASSWORD=CHANGE_THIS_GUACAMOLE_ADMIN_PASSWORD

# ============================================================================
# SCIM Configuration
# ============================================================================

# Generate with: openssl rand -base64 48
SCIM_BEARER_TOKEN=CHANGE_THIS_SCIM_BEARER_TOKEN

# ============================================================================
# BrowZer Configuration
# ============================================================================

BROWZER_ENABLED=true
BROWZER_CLIENT_ID=browzer-client
CONTINUOUS_VERIFY_ENABLED=true
CONTINUOUS_VERIFY_INTERVAL=30

# ============================================================================
# Rate Limiting Configuration
# ============================================================================

OPENIDX_ENABLE_RATE_LIMIT=true
RATE_LIMIT_RPM=60

# ============================================================================
# Backup Configuration
# ============================================================================

# Cron schedule: 0 2 * * * = 2:00 AM daily
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=7

# ============================================================================
# Observability Configuration
# ============================================================================

# Distributed tracing (set to true to enable)
TRACING_ENABLED=false
OTEL_ENDPOINT=jaeger:4317

# ============================================================================
# SSL/TLS Certificate Configuration
# ============================================================================

# Certbot/Let's Encrypt configuration
CERTBOT_EMAIL=admin@openidx.tdv.org
CERTBOT_CERTS_PATH=./data/certbot
CERTBOT_STAGING=false

# ============================================================================
# API Gateway Configuration
# ============================================================================

# APISIX Admin API Key (change this in production!)
APISIX_ADMIN_KEY=edd1c9f034335f136f87ad84b625c8f1

# ============================================================================
# CORS Configuration
# ============================================================================

# Allowed origins for API access
CORS_ALLOWED_ORIGINS=https://openidx.tdv.org

# ============================================================================
# Production Host Paths
# ============================================================================

# Ensure these directories exist before starting services
# mkdir -p ./backups/postgres
# mkdir -p ./data/{postgres,redis,elasticsearch,etcd,certbot}

# ============================================================================
# Secrets Generation Commands
# ============================================================================
#
# Generate all secrets at once:
#   openssl rand -base64 64 | tee >(sed 's/^/POSTGRES_PASSWORD=/' >> .env.production)
#
# Individual secrets:
#   openssl rand -base64 64  # JWT_SECRET, ACCESS_SESSION_SECRET
#   openssl rand -base64 48  # SCIM_BEARER_TOKEN
#   openssl rand -base64 32  # Other passwords
#
# ============================================================================
